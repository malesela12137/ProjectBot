Task 1: Connect to an Amazon Linux EC2 instance using SSM
In this task, you connect to your Amazon EC2 Instance using AWS Systems Manager Session Manager.

Choose the Details button at the top, then choose Show. 

Copy the InstanceSessionUrl value from the list and then paste it into a new web browser tab.

A console connection is made to the instance inside your web browser window using ssm-user, a prompt is displayed.

Run the following commands to change the user and home directory:

sudo su -l ec2-user
pwd
Note: This is the SSH terminal where you run commands as instructed throughout the lab.

 

Task 2: Configure the AWS CLI
Unlike some other Linux distributions that are available through Amazon Web Services (AWS), Amazon Linux instances already have the AWS CLI pre-installed on them.

In the SSH session terminal window, run the configure command to update the AWS CLI software with credentials.

aws configure
  

At the prompt, configure the following:

AWS Access Key ID: Copy and paste the value for AccessKey from pane in the left, into the terminal window.

AWS Secret Access Key: Copy and paste the value for SecretKey from pane in the left, into the terminal window.

Default region name: Enter us-west-2

Default output format: Enter json

 

Task 3: Create an S3 bucket using the AWS CLI
The s3api command creates a new S3 bucket with the AWS credentials in this lab. By default, the S3 bucket is created in the us-east-1 Region. 

Tip: In this lab, you might use the s3api command or the s3 command. s3 commands are built on top of the operations that are found in the s3api commands.

When you create a new S3 bucket, the bucket must have a unique name, such as the combination of your first initial, last name, and three random numbers. For example, if a user's name is Terry Whitlock, a bucket name could be twhitlock256

To create a bucket in Amazon S3, you use the aws s3api create-bucket command. When you use this command to create an S3 bucket, you also include the following:

Specify --region us-west-2

Add --create-bucket-configuration LocationConstraint=us-west-2 to the end of the command.

The following is an example of the command to create a new S3 bucket. You can use twhitlock256 as your bucket name, or you can replace <twhitlock256> with a bucket name that you prefer to use for this lab. 

aws s3api create-bucket --bucket <twhitlock256> --region us-west-2 --create-bucket-configuration LocationConstraint=us-west-2
If the command is successful, you will get a JSON-formatted response with a Location name-value pair, where the value reflects the bucket name. The following is an example:

{
        "Location": "http://twhitlock256.s3.amazonaws.com/"
}
Task 4: Create a new IAM user that has full access to Amazon S3
The AWS CLI command: aws iam create-user creates a new IAM user for your AWS account. The option --user-name is used to create the name of the user and must be unique within the account. 

Using the AWS CLI, create a new IAM user with the command aws iam create-user and username awsS3user: 

aws iam create-user --user-name awsS3user
Create a login profile for the new user by using the following command:

aws iam create-login-profile --user-name awsS3user --password Training123!
Copy the AWS account number:

In the AWS Management Console, choose the account VocLabsUser... drop down menu located at the top right of the screen.

Copy the 12 digit Account ID number.

In the current drop down menu, choose Sign Out.

Log in to the AWS Management Console as the new awsS3user user:

In the browser tab where you just signed out of the AWS Management Console, choose Log back in or Sign in to the Console. 

In the sign-in screen, choose the radio button IAM user.

In the text field, paste or enter the account ID with no dashes.

Choose Next.

A new login screen with Sign in as IAM user field will show. The account ID will be filled in from the previous screen.

For IAM user name, enter awsS3user

For Password, enter Training123!

Choose Sign In

On the AWS Management Console, in the Search box, enter S3 and choose S3. This option takes you to the Amazon S3 console page.

Note: The bucket that you created might not be visible. Refresh the Amazon S3 console page to see if it appears. The awsS3user user does not have Amazon S3 access to the bucket that you created, so you might see an error for Access to this bucket.  

In the terminal window, to find the AWS managed policy that grants full access to Amazon S3, run the following command:

aws iam list-policies --query "Policies[?contains(PolicyName,'S3')]"
The result displays policies that have a PolicyName attribute containing the term S3. Locate the policy that grants full access to Amazon S3. You use this policy in the next step.

To grant the awsS3user user full access to the S3 bucket, replace <policyYouFound> in following command with the appropriate PolicyName from the results, and run the adjusted command:

aws iam attach-user-policy --policy-arn arn:aws:iam::aws:policy/<policyYouFound> --user-name awsS3user
Return to the AWS Management Console, and refresh the browser tab.
